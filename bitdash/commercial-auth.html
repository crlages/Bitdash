<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bitdash â€¢ Login</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body{margin:0;background:#0b1020;color:#e8edff;font-family:Inter,Segoe UI,Arial}
    .wrap{max-width:760px;margin:40px auto;padding:20px}
    .card{background:#121a33;border:1px solid #2b3d72;border-radius:14px;padding:20px}
    .muted{color:#9aa7d8} .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    button{background:#1b2d5e;color:#fff;border:1px solid #3d58a6;border-radius:9px;padding:9px 12px;cursor:pointer}
    #status{margin-top:10px;color:#9aa7d8}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Login Premium</h1>
      <p class="muted">Entre com Google para usar carteira premium.</p>
      <div class="row">
        <button onclick="location.href='commercial-dashboard.html'">Ir para dashboard</button>
      </div>
      <div style="margin-top:14px" id="googleWrap"></div>
      <div id="status"></div>
    </div>
  </div>

<script>
const API = 'https://bitdash-api.crlages.workers.dev';
const GOOGLE_CLIENT_ID = '90657228527-vg76ohma7rj6pkpc7p9sk4spk13dlbc1.apps.googleusercontent.com';
const statusEl = document.getElementById('status');

function setAuth(token, email){
  if (token) localStorage.setItem('bitdash_auth_token', token);
  if (email) localStorage.setItem('bitdash_local_user', String(email).toLowerCase());
}

async function api(path, method='GET', body){
  const token = localStorage.getItem('bitdash_auth_token') || '';
  const headers = {'Content-Type':'application/json'};
  if (token) headers.Authorization = `Bearer ${token}`;
  const r = await fetch(API + path, { method, headers, body: body ? JSON.stringify(body) : undefined });
  const j = await r.json().catch(()=>({}));
  if (!r.ok || j.ok === false) throw new Error(j.error || `http_${r.status}`);
  return j;
}

async function doGoogleLogin(credential){
  try {
    statusEl.textContent = 'Autenticando...';
    const j = await api('/auth/google', 'POST', { credential });
    setAuth(j.token || '', j?.user?.email || '');
    statusEl.textContent = 'Login OK. Redirecionando...';
    location.href = 'commercial-dashboard.html';
  } catch (e) {
    statusEl.textContent = 'Falha no login: ' + (e.message || e);
  }
}

function initGoogle(){
  const wrap = document.getElementById('googleWrap');
  if (!window.google?.accounts?.id) {
    statusEl.textContent = 'Carregando Google...';
    setTimeout(initGoogle, 250);
    return;
  }
  window.google.accounts.id.initialize({
    client_id: GOOGLE_CLIENT_ID,
    auto_select: false,
    callback: (resp)=>doGoogleLogin(resp.credential)
  });
  window.google.accounts.id.renderButton(wrap, { theme:'outline', size:'large', text:'signin_with' });
}

initGoogle();
</script>
</body>
</html>